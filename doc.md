### документация к console library app

#### *Содержание*
1. [Сущность Library и её интерфейсы](#library)
2. [Сущность Archive и её интерфейсы](#archive)
3. [Генерация id и теневые записи(дубликаты)](#gen-id)

<br>

#### 1. Сущность Library и её интерфейсы <a id="library"></a>
Все интерфейсы Library взаимодействуют с пользователем через ввод в консоль данных и их последующую обработку.
Пользовательский ввод насколько это возможно валидируется (в рамках предоставленных возможностей) и парсится. Получает данные из архива (если команда предусматривает) и формирует человекочитаемый ответ.

отдельно стоит выделить метод

```python
def search(self) -> None:
```

и 

```python
@staticmethod
def _match(storage_data: dict[str, dict[str]], filter_attr: str) -> list[tuple[str]]:
```

Library получает команду search и данные по которым следует искать записи. В архив она делает запрос .all() для получение всёх записей, а фильтрует на своём уровне с помощью ._match.

#### 2. Сущность Archive и её интерфейсы <a id="archive"></a>

В рамкаx одной сессии скрипта данные между командами кешируются, если команды предполагают изменение содержимого архива (статуса, удаление, добавление) то кеш инвалидируется.

```python
def add(self, data: dict[str]) -> int:
```
Сценарии работы метода
1. Если книги нет - она добавляется
2. Если книга есть в архиве, но статус "выдана" - изменяется статус
3. Если книга есть в архиве и она в наличии - добавляется дубликат книги

```python
def delete(self, id: int) -> None:
```

Сценарии работы метода
1. Если книги нет в архиве - выбрасывается исключение, пользователь получит сообщение об отсутствии книги
2. Если книга есть и это дубликат - удаляется дубликат
3. Если книга есть и указанный id книги это оригинал - удаляется оригинал
4. Если книга есть и указанный id книги это оригинал, но у неё есть дубликаты в архиве - удаляется дубликат

```python
def all(self) -> dict[str, dict[str]]:
```
Возвращает все записи в архиве

```python
def change_status(self, id: str, new_status: str) -> int:
```
Сценарии работы метода
1. Если книги нет в архиве - выбрасывается исключение, пользователь получит сообщение об отсутсвии книги
2. Если переданый статус == текущему статусу - выбрасывается исключение, пользователь получит сообщение о том, что статус нет необходимости изменять он актуален.
3. Если у книги нет дубликатов - статус свободно изменяется
4. Если у книги есть дубликаты и переданый статус "выдана" - удаляется дубликат (статус оригинала не изменяется)
5. Если Переданный id ссылается на дубликат - дубликат удаляется

#### 3. Генерация id и теневые записи(дубликаты)<a id="gen-id"></a>

Так как мы имеем фиксированные получаемые данные от пользователя "title", "author", "year" и мы контрoлируем порядок ввода, мы можем атрибуты книги кодировать под видом id.

![id](./console_app/image/gen_id.png)

Что нам это даёт?
1. Используем преимущества python словарей где поиск по ключам  константный, что даёт нам преимущество при любом поиске в архиве.
2. Частичный поиск где нужно искать не только по id, но и по "title", "author", "year", т.к. они закодированы в Id, мы используем маску где:

    - t - "title"
    - a - "author"
    - y - "year"
    - d - дубликат и его порядковый номер

Что касается дубликатов.Так как мы имеет фиксированную структуру json записи книги, которая включается в себя "id", "title", "author", "year", "status". 
```json
  "t7578a10799y209": {
    "title": "Процесс",
    "author": "Франц Кафка",
    "year": "1925",
    "status": "в наличии"
  }
```
Добавлять идентичные книги под видом новых было бы иррацианально и затрудняло бы логику, например смена статуса на "выдана", если 2 идентичные книги есть в наличии, но под разными id. 
Если бы не фиксированная структура достаточно было бы добавить поле "count".

Альтернативой выступает помечать id книги как дубликат и присваивать ему порядковый номер (т.к. дубликатов может быть более чем 1)
```
{
  "t7578a10799y209": {
    "title": "Процесс",
    "author": "Франц Кафка",
    "year": "1925",
    "status": "в наличии"
  },
  "t7578a10799y209d1": {
    "title": "Процесс",
    "author": "Франц Кафка",
    "year": "1925",
    "status": "в наличии"
  }
}
```